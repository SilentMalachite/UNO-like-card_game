<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOÈ¢®„Ç´„Éº„Éâ„Ç≤„Éº„É†Ôºà8‰∫∫ÂØæÊà¶Ôºâ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }

        .game-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .setup-screen {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
            max-width: 500px;
        }

        .setup-screen h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .player-count {
            margin: 20px 0;
        }

        .player-count label {
            font-size: 1.2em;
            margin-right: 10px;
        }

        .player-count select {
            padding: 8px 12px;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            background: white;
            color: #333;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            max-width: 1200px;
            width: 100%;
        }

        .player-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            text-align: center;
        }

        .player-info.current-player {
            background: rgba(241, 196, 15, 0.3);
            border: 2px solid #f1c40f;
        }

        .player-info .player-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .player-info .card-count {
            font-size: 1.5em;
            color: #f1c40f;
        }

        .center-area {
            display: flex;
            gap: 20px;
            align-items: center;
            margin: 30px 0;
        }

        .deck {
            width: 80px;
            height: 120px;
            background: #2c3e50;
            border: 3px solid #34495e;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
            color: white;
        }

        .deck:hover {
            transform: scale(1.05);
        }

        .discard-pile {
            width: 80px;
            height: 120px;
            border: 3px dashed #fff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .card {
            width: 80px;
            height: 120px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #fff;
            font-weight: bold;
            font-size: 1.2em;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }

        .card.unplayable {
            opacity: 0.4;
            cursor: not-allowed !important;
            filter: grayscale(50%);
        }

        .card.unplayable:hover {
            transform: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .card.red { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .card.blue { background: linear-gradient(135deg, #3498db, #2980b9); }
        .card.green { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .card.yellow { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .card.wild { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; }
        .card.wild-draw4 { background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; }

        .card .number {
            font-size: 2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .card .action {
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            text-align: center;
        }

        .card .color-name {
            font-size: 0.7em;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .current-hand {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1000px;
            margin: 20px 0;
        }

        .game-controls {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            padding: 15px 30px;
            border-radius: 25px;
            margin: 15px 0;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
        }

        .turn-indicator {
            font-size: 1.8em;
            margin: 20px 0;
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .winner {
            font-size: 2em;
            color: #f1c40f;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .input-group {
            margin: 10px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            width: 200px;
        }

        .hidden {
            display: none !important;
        }

        .direction-indicator {
            font-size: 1.5em;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .arrow {
            font-size: 2em;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <h1 class="game-title">üé¥ UNOÈ¢®„Ç´„Éº„Éâ„Ç≤„Éº„É†ÔºàÂ§ö‰∫∫Êï∞ÂØæÊà¶Ôºâ</h1>
    
    <!-- „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÁîªÈù¢ -->
    <div id="setupScreen" class="setup-screen">
        <h2>„Ç≤„Éº„É†Ë®≠ÂÆö</h2>
        
        <div class="player-count">
            <label for="playerCount">„Éó„É¨„Ç§„É§„ÉºÊï∞:</label>
            <select id="playerCount">
                <option value="2">2‰∫∫</option>
                <option value="3">3‰∫∫</option>
                <option value="4">4‰∫∫</option>
                <option value="5">5‰∫∫</option>
                <option value="6">6‰∫∫</option>
                <option value="7">7‰∫∫</option>
                <option value="8" selected>8‰∫∫</option>
            </select>
        </div>

        <div id="playerNames"></div>
        
        <button class="btn btn-success" onclick="startGame()">„Ç≤„Éº„É†ÈñãÂßã</button>
    </div>

    <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
    <div id="gameScreen" class="hidden">
        <div class="players-grid" id="playersGrid"></div>
        
        <div class="turn-indicator" id="turnIndicator"></div>
        
        <div class="direction-indicator" id="directionIndicator">
            „Ç≤„Éº„É†ÈÄ≤Ë°åÊñπÂêë: <span class="arrow" id="directionArrow">‚Üí</span>
        </div>

        <div class="center-area">
            <div class="deck" id="deck" onclick="drawCard()">
                Â±±Êú≠<br><span id="deckCount">0</span>
            </div>
            <div class="discard-pile" id="discardPile"></div>
        </div>

        <div class="game-controls">
            <button class="btn btn-primary" onclick="showSetup()">Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†</button>
            <button class="btn btn-secondary" id="drawBtn" onclick="drawCard()">„Ç´„Éº„Éâ„ÇíÂºï„Åè</button>
            <button class="btn btn-secondary" id="endTurnBtn" onclick="endTurn()">„Çø„Éº„É≥ÁµÇ‰∫Ü</button>
            <button class="btn btn-success" id="unoBtn" onclick="callUno()" style="display: none;">UNO!</button>
        </div>

        <div id="message" class="message" style="display: none;"></div>

        <div class="current-hand" id="currentHand"></div>
    </div>

    <script>
        // „Ç≤„Éº„É†Áä∂ÊÖã
        let gameState = {
            players: [],
            deck: [],
            discardPile: [],
            currentPlayerIndex: 0,
            direction: 1, // 1: ÊôÇË®àÂõû„Çä, -1: ÂèçÊôÇË®àÂõû„Çä
            gameOver: false,
            canDraw: true,
            hasDrawn: false,
            unoCallRequired: {}, // „Éó„É¨„Ç§„É§„ÉºID„Çí„Ç≠„Éº„Å®„Åó„Å¶UNO„Ç≥„Éº„É´„ÅåÂøÖË¶Å„Åã„Å©„ÅÜ„Åã
            pendingDraw: 0, // Á©ç„ÅøÈáç„Å™„Å£„Åü„Éâ„É≠„ÉºÊï∞
            canStack: false // „Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„Éº„Éâ„ÅÆÁ©ç„ÅøÈáç„Å≠„ÅåÂèØËÉΩ„Åã
        };

        // „Ç´„Éº„Éâ„ÅÆËâ≤„Å®Êï∞Â≠ó
        const colors = ['red', 'blue', 'green', 'yellow'];
        const colorNames = { red: 'Ëµ§', blue: 'Èùí', green: 'Á∑ë', yellow: 'ÈªÑ' };
        const numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
        const actionCards = ['skip', 'reverse', 'draw2'];
        const actionNames = { skip: '„Çπ„Ç≠„ÉÉ„Éó', reverse: '„É™„Éê„Éº„Çπ', draw2: '„Éâ„É≠„Éº2' };
        const wildCardNames = { wild: '„ÉØ„Ç§„É´„Éâ', 'wild-draw4': '„ÉØ„Ç§„É´„Éâ+4' };

        // „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÁîªÈù¢„ÅÆÂàùÊúüÂåñ
        function initSetup() {
            const playerCountSelect = document.getElementById('playerCount');
            playerCountSelect.addEventListener('change', updatePlayerNameInputs);
            updatePlayerNameInputs();
        }

        // „Éó„É¨„Ç§„É§„ÉºÂêçÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÇíÊõ¥Êñ∞
        function updatePlayerNameInputs() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const container = document.getElementById('playerNames');
            container.innerHTML = '';

            for (let i = 1; i <= playerCount; i++) {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'input-group';
                inputGroup.innerHTML = `
                    <label>„Éó„É¨„Ç§„É§„Éº ${i} „ÅÆÂêçÂâç:</label>
                    <input type="text" id="player${i}Name" value="„Éó„É¨„Ç§„É§„Éº ${i}" maxlength="15">
                `;
                container.appendChild(inputGroup);
            }
        }

        // „Éá„ÉÉ„Ç≠„Çí‰ΩúÊàê
        function createDeck() {
            const deck = [];
            
            // ÂêÑËâ≤„Å´0-9„ÅÆÊï∞Â≠ó„Ç´„Éº„Éâ„Çí‰ΩúÊàêÔºà0„ÅØ1Êûö„ÄÅ1-9„ÅØ2Êûö„Åö„Å§Ôºâ
            colors.forEach(color => {
                // 0„ÅÆ„Ç´„Éº„Éâ„ÅØÂêÑËâ≤1Êûö„ÅÆ„Åø
                deck.push({ type: 'number', color, number: 0 });
                // 1-9„ÅÆ„Ç´„Éº„Éâ„ÅØÂêÑËâ≤2Êûö„Åö„Å§
                for (let number = 1; number <= 9; number++) {
                    deck.push({ type: 'number', color, number });
                    deck.push({ type: 'number', color, number });
                }
                
                // „Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„Éº„Éâ„ÇíÂêÑËâ≤2Êûö„Åö„Å§ËøΩÂä†
                actionCards.forEach(action => {
                    deck.push({ type: 'action', color, action });
                    deck.push({ type: 'action', color, action });
                });
            });
            
            // „ÉØ„Ç§„É´„Éâ„Ç´„Éº„Éâ„ÇíËøΩÂä†ÔºàÂêÑ4ÊûöÔºâ
            for (let i = 0; i < 4; i++) {
                deck.push({ type: 'wild', action: 'wild' });
            }
            for (let i = 0; i < 4; i++) {
                deck.push({ type: 'wild', action: 'wild-draw4' });
            }
            
            // „Éá„Éê„ÉÉ„Ç∞Áî®Ôºö„Éá„ÉÉ„Ç≠„ÅÆÁ∑èÊï∞„ÇíÁ¢∫Ë™ç
            console.log(`„Éá„ÉÉ„Ç≠‰ΩúÊàêÂÆå‰∫Ü: Á∑è${deck.length}Êûö`);
            
            return shuffleDeck(deck);
        }

        // „Éá„ÉÉ„Ç≠„Çí„Ç∑„É£„ÉÉ„Éï„É´
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        // „Ç´„Éº„Éâ„ÇíÊèèÁîª
        function renderCard(card, clickHandler = null, isClickable = true) {
            const cardEl = document.createElement('div');
            let cardClass = 'card ';
            
            if (card.type === 'wild') {
                cardClass += card.action;
            } else {
                cardClass += card.color;
            }
            
            cardEl.className = cardClass;
            if (!isClickable) cardEl.style.cursor = 'default';
            
            let cardContent;
            if (card.type === 'number') {
                cardContent = `
                    <div class="number">${card.number}</div>
                    <div class="color-name">${colorNames[card.color]}</div>
                `;
            } else if (card.type === 'action') {
                cardContent = `
                    <div class="action">${actionNames[card.action]}</div>
                    <div class="color-name">${colorNames[card.color]}</div>
                `;
            } else if (card.type === 'wild') {
                cardContent = `
                    <div class="action">${wildCardNames[card.action]}</div>
                    <div class="color-name">ÂÖ®Ëâ≤ÂØæÂøú</div>
                `;
            }
            
            cardEl.innerHTML = cardContent;
            
            if (clickHandler && isClickable) {
                cardEl.onclick = clickHandler;
            }
            
            return cardEl;
        }

        // ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅÆÊâãÊú≠„ÇíË°®Á§∫
        function renderCurrentHand() {
            const handEl = document.getElementById('currentHand');
            handEl.innerHTML = '';
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            currentPlayer.hand.forEach((card, index) => {
                const isPlayable = canPlayCard(card);
                const cardEl = renderCard(card, isPlayable ? () => playCard(index) : null, isPlayable);
                
                if (!isPlayable) {
                    cardEl.classList.add('unplayable');
                    cardEl.title = '„Åì„ÅÆ„Ç´„Éº„Éâ„ÅØÂá∫„Åõ„Åæ„Åõ„Çì';
                }
                
                handEl.appendChild(cardEl);
            });
        }

        // „Éó„É¨„Ç§„É§„ÉºÊÉÖÂ†±„ÇíË°®Á§∫
        function renderPlayersGrid() {
            const gridEl = document.getElementById('playersGrid');
            gridEl.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerEl = document.createElement('div');
                playerEl.className = 'player-info';
                if (index === gameState.currentPlayerIndex) {
                    playerEl.classList.add('current-player');
                }
                
                playerEl.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="card-count">${player.hand.length}Êûö</div>
                `;
                
                gridEl.appendChild(playerEl);
            });
        }

        // Êç®„Å¶Êú≠„ÇíË°®Á§∫
        function renderDiscardPile() {
            const discardEl = document.getElementById('discardPile');
            discardEl.innerHTML = '';
            
            if (gameState.discardPile.length > 0) {
                const topCard = gameState.discardPile[gameState.discardPile.length - 1];
                const cardEl = renderCard(topCard, null, false);
                discardEl.appendChild(cardEl);
            }
        }

        // „Ç´„Éº„Éâ„Åå„Éó„É¨„Ç§ÂèØËÉΩ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        function canPlayCard(card) {
            if (gameState.discardPile.length === 0) return true;
            
            const topCard = gameState.discardPile[gameState.discardPile.length - 1];
            
            // „Éâ„É≠„Éº„ÅåÁ©ç„ÅøÈáç„Å™„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„É´„Éº„É´
            if (gameState.pendingDraw > 0 && gameState.canStack) {
                // „Éâ„É≠„Éº2„Åß„Éâ„É≠„Éº2„ÇíÁ©ç„ÅøÈáç„Å≠„Çâ„Çå„Çã
                if (card.type === 'action' && card.action === 'draw2' && topCard.type === 'action' && topCard.action === 'draw2') {
                    return true;
                }
                // „ÉØ„Ç§„É´„Éâ„Éâ„É≠„Éº4„Åß„ÉØ„Ç§„É´„Éâ„Éâ„É≠„Éº4„ÇíÁ©ç„ÅøÈáç„Å≠„Çâ„Çå„Çã
                if (card.type === 'wild' && card.action === 'wild-draw4' && topCard.type === 'wild' && topCard.action === 'wild-draw4') {
                    return true;
                }
                // „Åù„Çå‰ª•Â§ñ„ÅÆ„Ç´„Éº„Éâ„ÅØ„Éó„É¨„Ç§‰∏çÂèØ
                return false;
            }
            
            // „ÉØ„Ç§„É´„Éâ„Ç´„Éº„Éâ„ÅØÂ∏∏„Å´„Éó„É¨„Ç§ÂèØËÉΩ
            if (card.type === 'wild') return true;
            
            // Ëâ≤„Åå‰∏ÄËá¥Ôºà„ÉØ„Ç§„É´„Éâ„Ç´„Éº„Éâ„ÅÆËâ≤„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÇÇÂê´„ÇÄÔºâ
            if (card.color === topCard.color || (topCard.chosenColor && card.color === topCard.chosenColor)) return true;
            
            // Êï∞Â≠ó„Ç´„Éº„ÉâÂêåÂ£´„ÅßÊï∞Â≠ó„Åå‰∏ÄËá¥
            if (card.type === 'number' && topCard.type === 'number' && card.number === topCard.number) return true;
            
            // „Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„Éº„ÉâÂêåÂ£´„ÅßÁ®ÆÈ°û„Åå‰∏ÄËá¥
            if (card.type === 'action' && topCard.type === 'action' && card.action === topCard.action) return true;
            
            return false;
        }

        // „Ç´„Éº„Éâ„Çí„Éó„É¨„Ç§
        function playCard(cardIndex) {
            if (gameState.gameOver) return;
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const card = currentPlayer.hand[cardIndex];
            
            if (!canPlayCard(card)) {
                showMessage('„Åù„ÅÆ„Ç´„Éº„Éâ„ÅØÂá∫„Åõ„Åæ„Åõ„ÇìÔºÅ', 2000);
                return;
            }
            
            // „Ç´„Éº„Éâ„ÇíÊâãÊú≠„Åã„ÇâÊç®„Å¶Êú≠„Å´ÁßªÂãï
            currentPlayer.hand.splice(cardIndex, 1);
            gameState.discardPile.push(card);
            gameState.canDraw = true;
            gameState.hasDrawn = false;
            
            // ÂãùÂà©„ÉÅ„Çß„ÉÉ„ÇØ
            if (currentPlayer.hand.length === 0) {
                endGame(currentPlayer.name);
                return;
            }
            
            // UNO„Ç≥„Éº„É´„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÔºàÊâãÊú≠„Åå1Êûö„Å´„Å™„Å£„ÅüÊôÇÔºâ
            if (currentPlayer.hand.length === 1) {
                gameState.unoCallRequired[gameState.currentPlayerIndex] = true;
                showMessage(`${currentPlayer.name}„Åï„Çì„ÅØUNO„Çí„Ç≥„Éº„É´„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„ÅôÔºÅ`, 3000);
                // UNO„Éú„Çø„É≥„ÇíË°®Á§∫
                document.getElementById('unoBtn').style.display = 'inline-block';
            }
            
            // „Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„Éº„Éâ„ÅÆÂäπÊûú„ÇíÂÆüË°å
            if (card.type === 'action') {
                executeActionCard(card);
            } else if (card.type === 'wild') {
                executeWildCard(card);
            } else {
                // ÈÄöÂ∏∏„ÅÆÊï∞Â≠ó„Ç´„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´ÈÄ≤„ÇÄ
                nextPlayer();
            }
        }

        // „Ç´„Éº„Éâ„ÇíÂ±±Êú≠„Åã„ÇâÂºï„Åè
        function drawCard() {
            if (gameState.gameOver) return;
            
            if (gameState.deck.length === 0) {
                const reshuffled = reshuffleDeck();
                if (!reshuffled || gameState.deck.length === 0) {
                    showMessage('Â±±Êú≠„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºÅ„Ç≤„Éº„É†„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô', 3000);
                    endGame('Âºï„ÅçÂàÜ„Åë');
                    return;
                }
            }
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const drawnCard = gameState.deck.pop();
            currentPlayer.hand.push(drawnCard);
            gameState.hasDrawn = true;
            
            showMessage(`${currentPlayer.name}„Åå„Ç´„Éº„Éâ„ÇíÂºï„Åç„Åæ„Åó„Åü`, 1500);
            
            updateDisplay();
        }

        // Â±±Êú≠„ÇíÂÜç„Ç∑„É£„ÉÉ„Éï„É´
        function reshuffleDeck() {
            if (gameState.discardPile.length <= 1) {
                showMessage('„É™„Ç∑„É£„ÉÉ„Éï„É´„Åß„Åç„Åæ„Åõ„Çì„ÄÇÊç®„Å¶Êú≠„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô', 2000);
                return false;
            }
            
            // Êç®„Å¶Êú≠„ÅÆ‰∏ÄÁï™‰∏ä‰ª•Â§ñ„ÇíÂ±±Êú≠„Å´Êàª„Åô
            const topCard = gameState.discardPile.pop();
            const cardsToShuffle = [...gameState.discardPile];
            gameState.discardPile = [topCard];
            gameState.deck = shuffleDeck(cardsToShuffle);
            
            showMessage(`Êç®„Å¶Êú≠${cardsToShuffle.length}Êûö„ÇíÂ±±Êú≠„Å´„Ç∑„É£„ÉÉ„Éï„É´„Åó„Åæ„Åó„Åü`, 2000);
            return true;
        }

        // „Çø„Éº„É≥ÁµÇ‰∫Ü
        function endTurn() {
            if (gameState.gameOver) return;
            
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const hasPlayableCard = currentPlayer.hand.some(card => canPlayCard(card));
            
            // „Éó„É¨„Ç§ÂèØËÉΩ„Å™„Ç´„Éº„Éâ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Ç´„Éº„Éâ„ÇíÂá∫„Åô„ÅãÂºï„Åè„Åã„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã
            if (!gameState.hasDrawn && gameState.canDraw && hasPlayableCard) {
                showMessage('„Éó„É¨„Ç§ÂèØËÉΩ„Å™„Ç´„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Ç´„Éº„Éâ„ÇíÂá∫„Åô„Åã„Ç´„Éº„Éâ„ÇíÂºï„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ', 2000);
                return;
            }
            
            // „Éó„É¨„Ç§ÂèØËÉΩ„Å™„Ç´„Éº„Éâ„Åå„Å™„ÅÑÂ†¥Âêà„ÄÅ„Åæ„Åü„ÅØ„Ç´„Éº„Éâ„ÇíÂºï„ÅÑ„ÅüÂ†¥Âêà„ÅØ„Çø„Éº„É≥ÁµÇ‰∫ÜÂèØËÉΩ
            nextPlayer();
        }

        // „Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„Éº„Éâ„ÅÆÂäπÊûú„ÇíÂÆüË°å
        function executeActionCard(card) {
            switch (card.action) {
                case 'skip':
                    showMessage(`${gameState.players[gameState.currentPlayerIndex].name}„Åå„Çπ„Ç≠„ÉÉ„Éó„Ç´„Éº„Éâ„ÇíÂá∫„Åó„Åæ„Åó„ÅüÔºÅÊ¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô`, 2500);
                    nextPlayer(); // ÈÄöÂ∏∏„ÅÆÊ¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´ÈÄ≤„ÇÄ
                    nextPlayer(); // „Åï„Çâ„Å´„ÇÇ„ÅÜ‰∏Ä‰∫∫È£õ„Å∞„Åô
                    break;
                
                case 'reverse':
                    gameState.direction *= -1;
                    showMessage(`${gameState.players[gameState.currentPlayerIndex].name}„Åå„É™„Éê„Éº„Çπ„Ç´„Éº„Éâ„ÇíÂá∫„Åó„Åæ„Åó„ÅüÔºÅÈ†ÜÁï™„ÅåÈÄÜ„Å´„Å™„Çä„Åæ„Åô`, 2500);
                    nextPlayer();
                    break;
                
                case 'draw2':
                    // „Çπ„Çø„ÉÉ„ÇØ„É´„Éº„É´„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
                    if (gameState.pendingDraw > 0 && gameState.canStack) {
                        gameState.pendingDraw += 2;
                        showMessage(`${gameState.players[gameState.currentPlayerIndex].name}„Åå„Éâ„É≠„Éº2„ÇíÁ©ç„ÅøÈáç„Å≠„Åæ„Åó„ÅüÔºÅÁ∑è„Éâ„É≠„ÉºÊï∞: ${gameState.pendingDraw}Êûö`, 2500);
                    } else {
                        gameState.pendingDraw = 2;
                        gameState.canStack = true;
                        showMessage(`${gameState.players[gameState.currentPlayerIndex].name}„Åå„Éâ„É≠„Éº2„Ç´„Éº„Éâ„ÇíÂá∫„Åó„Åæ„Åó„ÅüÔºÅ`, 2500);
                    }
                    nextPlayer();
                    // Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Åå„Éâ„É≠„Éº2„ÇíÂá∫„Åõ„Å™„ÅÑÂ†¥Âêà„ÅÆÂá¶ÁêÜ„ÅØ„Çø„Éº„É≥ÈñãÂßãÊôÇ„Å´Ë°å„ÅÜ
                    break;
            }
        }
        
        // „ÉØ„Ç§„É´„Éâ„Ç´„Éº„Éâ„ÅÆÂäπÊûú„ÇíÂÆüË°å
        function executeWildCard(card) {
            // Ëâ≤ÈÅ∏Êäû„ÅÆÂá¶ÁêÜ
            const chosenColor = prompt('Ëâ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ:\n1: Ëµ§ (red)\n2: Èùí (blue)\n3: Á∑ë (green)\n4: ÈªÑ (yellow)', '1');
            
            let colorChoice;
            switch (chosenColor) {
                case '1': colorChoice = 'red'; break;
                case '2': colorChoice = 'blue'; break;
                case '3': colorChoice = 'green'; break;
                case '4': colorChoice = 'yellow'; break;
                default: colorChoice = 'red'; // „Éá„Éï„Ç©„É´„Éà„ÅØËµ§
            }
            
            // Êç®„Å¶Êú≠„ÅÆ‰∏ÄÁï™‰∏ä„ÅÆ„Ç´„Éº„Éâ„Å´ÈÅ∏Êäû„Åó„ÅüËâ≤„ÇíËøΩÂä†
            const topCard = gameState.discardPile[gameState.discardPile.length - 1];
            topCard.chosenColor = colorChoice;
            
            if (card.action === 'wild') {
                showMessage(`${gameState.players[gameState.currentPlayerIndex].name}„Åå„ÉØ„Ç§„É´„Éâ„Ç´„Éº„Éâ„ÇíÂá∫„Åó„Åæ„Åó„ÅüÔºÅÊ¨°„ÅÆËâ≤„ÅØ${colorNames[colorChoice]}„Åß„Åô`, 2500);
                nextPlayer();
            } else if (card.action === 'wild-draw4') {
                // „Çπ„Çø„ÉÉ„ÇØ„É´„Éº„É´„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
                if (gameState.pendingDraw > 0 && gameState.canStack) {
                    gameState.pendingDraw += 4;
                    showMessage(`${gameState.players[gameState.currentPlayerIndex].name}„Åå„ÉØ„Ç§„É´„Éâ„Éâ„É≠„Éº4„ÇíÁ©ç„ÅøÈáç„Å≠„Åæ„Åó„ÅüÔºÅÁ∑è„Éâ„É≠„ÉºÊï∞: ${gameState.pendingDraw}Êûö„ÄÇÊ¨°„ÅÆËâ≤„ÅØ${colorNames[colorChoice]}„Åß„Åô`, 3000);
                } else {
                    gameState.pendingDraw = 4;
                    gameState.canStack = true;
                    showMessage(`${gameState.players[gameState.currentPlayerIndex].name}„Åå„ÉØ„Ç§„É´„Éâ„Éâ„É≠„Éº4„ÇíÂá∫„Åó„Åæ„Åó„ÅüÔºÅÊ¨°„ÅÆËâ≤„ÅØ${colorNames[colorChoice]}„Åß„Åô`, 3000);
                }
                nextPlayer();
            }
        }
        
        // UNO„Çí„Ç≥„Éº„É´„Åô„ÇãÈñ¢Êï∞
        function callUno() {
            const currentPlayerIndex = gameState.currentPlayerIndex;
            if (gameState.unoCallRequired[currentPlayerIndex]) {
                delete gameState.unoCallRequired[currentPlayerIndex];
                showMessage(`${gameState.players[currentPlayerIndex].name}„ÅåUNO„Çí„Ç≥„Éº„É´„Åó„Åæ„Åó„ÅüÔºÅ`, 2000);
                document.getElementById('unoBtn').style.display = 'none';
            }
        }
        
        // Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´ÈÄ≤„ÇÄ
        function nextPlayer() {
            // ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅåUNO„Ç≥„Éº„É´„ÇíÂøò„Çå„ÅüÂ†¥Âêà„ÅÆ„Éö„Éä„É´„ÉÜ„Ç£
            const currentPlayerIndex = gameState.currentPlayerIndex;
            if (gameState.unoCallRequired[currentPlayerIndex]) {
                const currentPlayer = gameState.players[currentPlayerIndex];
                showMessage(`${currentPlayer.name}„ÅåUNO„Ç≥„Éº„É´„ÇíÂøò„Çå„Åæ„Åó„ÅüÔºÅ„Éö„Éä„É´„ÉÜ„Ç£„Åß2ÊûöÂºï„Åç„Åæ„Åô`, 3000);
                
                // „Éö„Éä„É´„ÉÜ„Ç£„Åß2ÊûöÂºï„Åè
                for (let i = 0; i < 2; i++) {
                    if (gameState.deck.length === 0) {
                        const reshuffled = reshuffleDeck();
                        if (!reshuffled) break;
                    }
                    if (gameState.deck.length > 0) {
                        currentPlayer.hand.push(gameState.deck.pop());
                    }
                }
                
                delete gameState.unoCallRequired[currentPlayerIndex];
            }
            
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + gameState.direction + gameState.players.length) % gameState.players.length;
            gameState.canDraw = true;
            gameState.hasDrawn = false;
            
            // UNO„Éú„Çø„É≥„ÇíÈùûË°®Á§∫
            document.getElementById('unoBtn').style.display = 'none';
            
            // „Éâ„É≠„Éº„Ç´„Éº„Éâ„ÅÆÁ©ç„ÅøÈáç„Å≠Âá¶ÁêÜ
            const newCurrentPlayer = gameState.players[gameState.currentPlayerIndex];
            if (gameState.pendingDraw > 0) {
                // ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„Åå„Çπ„Çø„ÉÉ„ÇØÂèØËÉΩ„Å™„Ç´„Éº„Éâ„ÇíÊåÅ„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const topCard = gameState.discardPile[gameState.discardPile.length - 1];
                let canStackCard = false;
                
                if (topCard.type === 'action' && topCard.action === 'draw2') {
                    canStackCard = newCurrentPlayer.hand.some(card => card.type === 'action' && card.action === 'draw2');
                } else if (topCard.type === 'wild' && topCard.action === 'wild-draw4') {
                    canStackCard = newCurrentPlayer.hand.some(card => card.type === 'wild' && card.action === 'wild-draw4');
                }
                
                if (!canStackCard || !gameState.canStack) {
                    // „Çπ„Çø„ÉÉ„ÇØ„Åß„Åç„Å™„ÅÑ„ÅÆ„Åß„Ç´„Éº„Éâ„ÇíÂºï„Åè
                    for (let i = 0; i < gameState.pendingDraw; i++) {
                        if (gameState.deck.length === 0) {
                            const reshuffled = reshuffleDeck();
                            if (!reshuffled) break;
                        }
                        if (gameState.deck.length > 0) {
                            newCurrentPlayer.hand.push(gameState.deck.pop());
                        }
                    }
                    showMessage(`${newCurrentPlayer.name}„Åå${gameState.pendingDraw}ÊûöÂºï„Åç„Åæ„Åó„Åü„ÄÇ„Çø„Éº„É≥„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô`, 2500);
                    gameState.pendingDraw = 0;
                    gameState.canStack = false;
                    // „ÇÇ„ÅÜ‰∏ÄÂ∫¶Ê¨°„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´ÈÄ≤„ÇÄ
                    gameState.currentPlayerIndex = (gameState.currentPlayerIndex + gameState.direction + gameState.players.length) % gameState.players.length;
                }
            }
            
            updateDisplay();
        }

        // „Ç≤„Éº„É†ÁµÇ‰∫Ü
        function endGame(winnerName) {
            gameState.gameOver = true;
            
            if (winnerName === 'Âºï„ÅçÂàÜ„Åë') {
                document.getElementById('turnIndicator').innerHTML = `<div class="winner">ü§ù Âºï„ÅçÂàÜ„Åë„Åß„Åô</div>`;
                showMessage('Â±±Êú≠„ÅåË∂≥„Çä„Å™„Åè„Å™„Çä„Åæ„Åó„Åü„ÄÇÊñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 5000);
            } else {
                document.getElementById('turnIndicator').innerHTML = `<div class="winner">üéâ ${winnerName}„Åï„Çì„ÅÆÂãùÂà©ÔºÅ</div>`;
                showMessage('„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅÊñ∞„Åó„ÅÑ„Ç≤„Éº„É†„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶ÂÜçÂ∫¶„Éó„É¨„Ç§„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 5000);
            }
            
            // „Ç≤„Éº„É†ÁµÇ‰∫ÜÊôÇ„Å´„Åô„Åπ„Å¶„ÅÆ„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            document.getElementById('drawBtn').disabled = true;
            document.getElementById('endTurnBtn').disabled = true;
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
        function showMessage(text, duration = 3000) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, duration);
        }

        // ÁîªÈù¢„ÇíÊõ¥Êñ∞
        function updateDisplay() {
            renderCurrentHand();
            renderPlayersGrid();
            renderDiscardPile();
            
            document.getElementById('deckCount').textContent = gameState.deck.length;
            
            if (!gameState.gameOver) {
                const currentPlayer = gameState.players[gameState.currentPlayerIndex];
                document.getElementById('turnIndicator').textContent = `${currentPlayer.name}„Åï„Çì„ÅÆ„Çø„Éº„É≥„Åß„Åô`;
            }
            
            // ÊñπÂêë„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíÊõ¥Êñ∞
            document.getElementById('directionArrow').textContent = gameState.direction === 1 ? '‚Üí' : '‚Üê';
            
            document.getElementById('drawBtn').disabled = gameState.gameOver || gameState.hasDrawn;
            document.getElementById('endTurnBtn').disabled = gameState.gameOver;
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        function startGame() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            
            // „Éó„É¨„Ç§„É§„ÉºÊÉÖÂ†±„ÇíÂèéÈõÜ
            gameState.players = [];
            for (let i = 1; i <= playerCount; i++) {
                const name = document.getElementById(`player${i}Name`).value.trim() || `„Éó„É¨„Ç§„É§„Éº ${i}`;
                gameState.players.push({
                    name: name,
                    hand: []
                });
            }
            
            // „Ç≤„Éº„É†Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            gameState.deck = createDeck();
            gameState.discardPile = [];
            gameState.currentPlayerIndex = 0;
            gameState.direction = 1;
            gameState.gameOver = false;
            gameState.canDraw = true;
            gameState.hasDrawn = false;
            gameState.unoCallRequired = {};
            gameState.pendingDraw = 0;
            gameState.canStack = false;
            
            // ÊâãÊú≠„ÇíÈÖç„ÇãÔºàÂêÑ„Éó„É¨„Ç§„É§„Éº„Å´7Êûö„Åö„Å§Ôºâ
            for (let i = 0; i < 7; i++) {
                gameState.players.forEach(player => {
                    if (gameState.deck.length > 0) {
                        player.hand.push(gameState.deck.pop());
                    }
                });
            }
            
            // ÊúÄÂàù„ÅÆÊç®„Å¶Êú≠„ÇíÁΩÆ„ÅèÔºà„Ç¢„ÇØ„Ç∑„Éß„É≥„Ç´„Éº„Éâ„ÇÑ„ÉØ„Ç§„É´„Éâ„Ç´„Éº„Éâ„ÅØÈÅø„Åë„ÇãÔºâ
            let firstCard;
            do {
                if (gameState.deck.length === 0) break;
                firstCard = gameState.deck.pop();
            } while (firstCard && (firstCard.type === 'action' || firstCard.type === 'wild'));
            
            if (firstCard) {
                gameState.discardPile.push(firstCard);
            } else if (gameState.deck.length > 0) {
                // „ÇÇ„Åó„ÇÇÊï∞Â≠ó„Ç´„Éº„Éâ„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØÊúÄÂàù„ÅÆ„Ç´„Éº„Éâ„Çí‰ΩøÁî®
                gameState.discardPile.push(gameState.deck.pop());
            }
            
            // ÁîªÈù¢Âàá„ÇäÊõø„Åà
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            updateDisplay();
            showMessage('„Ç≤„Éº„É†„ÅåÂßã„Åæ„Çä„Åæ„Åó„ÅüÔºÅ', 2000);
        }

        // „Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÁîªÈù¢„Å´Êàª„Çã
        function showSetup() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
        }

        // ÂàùÊúüÂåñ
        initSetup();
    </script>
</body>
</html>